<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phân tích xổ số miền Bắc</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7fc;
        }

        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        label {
            font-size: 1.1rem;
            color: #333;
        }

        input {
            padding: 10px;
            font-size: 1rem;
            margin: 10px 0;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
        }

        button:hover {
            background-color: #45a049;
        }

        #result {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        #copyButton {
            background-color: #008CBA;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
        }

        #copyButton:hover {
            background-color: #007bb5;
        }

        #copyMessage {
            display: none;
            color: green;
            font-size: 1rem;
            margin-top: 10px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                width: 90%;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Phân tích xổ số miền Bắc</h1>

        <label for="daysAgo">Nhập số ngày quá khứ bạn muốn phân tích (ví dụ: 1618 ngày):</label>
        <input type="number" id="daysAgo" placeholder="Nhập số ngày quá khứ" min="1" required />

        <label for="numberOfResults">Bạn muốn lấy bao nhiêu con số?</label>
        <input type="number" id="numberOfResults" placeholder="Nhập số kết quả" min="1" required />

        <label for="numberOf3D">Số lượng 3D bạn muốn lấy (từ vị trí 3 trở đi):</label>
        <input type="number" id="numberOf3D" placeholder="Nhập số lượng 3D" min="1" required />

        <label for="numberOf4D">Số lượng 4D bạn muốn lấy (từ vị trí 4 trở đi):</label>
        <input type="number" id="numberOf4D" placeholder="Nhập số lượng 4D" min="1" required />

        <button onclick="processData()">Xử lý</button>

        <div id="result"></div>

        <button id="copyButton" onclick="copyToClipboard()">Sao chép kết quả</button>
        <div id="copyMessage">Đã Copy!</div>
    </div>

    <script>
        // Hàm đọc dữ liệu từ URL và xử lý
        async function processDataFromUrl(url, numberOfResults, daysAgo, numberOf3D, numberOf4D) {
            try {
                const response = await fetch(url);
                const data = await response.text();

                // Tách dữ liệu thành các dòng
                const lines = data.split('\n').filter(line => line.trim() !== '');

                let allNumbers = [];
                let threeDNumbers = [];
                let fourDNumbers = [];

                // Tính ngày gần đây để lọc dữ liệu
                const currentDate = new Date();
                const startDate = new Date(currentDate);
                startDate.setDate(currentDate.getDate() - daysAgo);

                lines.forEach((line, index) => {
                    if (index === 0) return; // Bỏ qua dòng tiêu đề

                    const columns = line.split(',');

                    // Lọc theo ngày
                    const date = new Date(columns[0]);
                    if (date < startDate) return;

                    // Lấy số đầu tiên trong cột đầu tiên và lấy 2 số cuối
                    const firstNumber = columns[1].trim();
                    const lastTwoDigits = firstNumber.slice(-2);
                    allNumbers.push(lastTwoDigits);

                    // Lấy các số 3D từ vị trí 3 trở đi
                    if (columns.length > 2) {
                        const thirdDigit = columns[2].trim().charAt(2);
                        threeDNumbers.push(thirdDigit);
                    }

                    // Lấy các số 4D từ vị trí 4 trở đi
                    if (columns.length > 3) {
                        const fourthDigit = columns[3].trim().charAt(3);
                        fourDNumbers.push(fourthDigit);
                    }
                });

                // Chuẩn hóa các số để đảm bảo định dạng 2 chữ số
                allNumbers = allNumbers.map(num => num.padStart(2, '0'));
                threeDNumbers = threeDNumbers.slice(0, numberOf3D);
                fourDNumbers = fourDNumbers.slice(0, numberOf4D);

                // Đếm tần suất xuất hiện của từng số
                const frequencyMap = {};
                allNumbers.forEach(num => {
                    if (!frequencyMap[num]) {
                        frequencyMap[num] = 0;
                    }
                    frequencyMap[num]++;
                });

                // Sắp xếp các số theo tần suất giảm dần
                const sortedNumbers = Object.keys(frequencyMap)
                    .sort((a, b) => frequencyMap[b] - frequencyMap[a]);

                // Lấy số lượng kết quả mong muốn
                const result = sortedNumbers.slice(0, numberOfResults);

                // Sắp xếp kết quả cuối cùng theo thứ tự từ bé đến lớn
                const sortedResult = result.sort((a, b) => parseInt(a, 10) - parseInt(b, 10));

                // Hiển thị kết quả
                const resultText = `Các số có khả năng xuất hiện cao nhất: ${sortedResult.join(', ')}
                                    <br>3D Numbers: ${threeDNumbers.join(', ')}
                                    <br>4D Numbers: ${fourDNumbers.join(', ')}`;
                document.getElementById('result').innerHTML = resultText;

            } catch (error) {
                console.error('Lỗi khi đọc dữ liệu từ URL hoặc xử lý:', error.message);
                document.getElementById('result').innerHTML = 'Đã xảy ra lỗi khi xử lý dữ liệu.';
            }
        }

        // Hàm xử lý dữ liệu từ giao diện người dùng
        function processData() {
            const daysAgo = parseInt(document.getElementById('daysAgo').value, 10);
            const numberOfResults = parseInt(document.getElementById('numberOfResults').value, 10);
            const numberOf3D = parseInt(document.getElementById('numberOf3D').value, 10);
            const numberOf4D = parseInt(document.getElementById('numberOf4D').value, 10);

            if (isNaN(daysAgo) || daysAgo <= 0) {
                alert('Vui lòng nhập số ngày hợp lệ.');
                return;
            }

            if (isNaN(numberOfResults) || numberOfResults <= 0) {
                alert('Vui lòng nhập số lượng kết quả hợp lệ.');
                return;
            }

            if (isNaN(numberOf3D) || numberOf3D <= 0) {
                alert('Vui lòng nhập số lượng 3D hợp lệ.');
                return;
            }

            if (isNaN(numberOf4D) || numberOf4D <= 0) {
                alert('Vui lòng nhập số lượng 4D hợp lệ.');
                return;
            }

            const url = 'https://raw.githubusercontent.com/khiemdoan/vietnam-lottery-xsmb-analysis/refs/heads/main/data/xsmb.csv';
            processDataFromUrl(url, numberOfResults, daysAgo, numberOf3D, numberOf4D);
        }

        // Hàm sao chép kết quả
        function copyToClipboard() {
            const resultText = document.getElementById('result').innerText;
            if (!resultText) {
                alert('Không có kết quả để sao chép!');
                return;
            }

            navigator.clipboard.writeText(resultText)
                .then(() => {
                    const copyMessage = document.getElementById('copyMessage');
                    copyMessage.style.display = 'block';
                    setTimeout(() => {
                        copyMessage.style.display = 'none';
                    }, 2000);
                })
                .catch(err => {
                    console.error('Lỗi sao chép: ', err);
                });
        }
    </script>

</body>
</html>
