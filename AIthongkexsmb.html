<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Xổ Số - Phiên Bản Pro</title>
    <link rel="icon" href="lottery.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #000428 0%, #004e92 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFC107, #FF5722);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            position: relative;
        }

        .input-group label {
            color: #fff;
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: 500;
        }

        select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
        }

        select option {
            background: #004e92;
            color: #fff;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4A00E0, #8E2DE2);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .statistics {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            color: #fff;
        }

        .statistics h2 {
            color: #FFC107;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .results {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            color: #fff;
        }

        .result-title {
            color: #FFC107;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            font-weight: 500;
            color: #4CAF50;
        }

        .result-numbers {
            font-family: monospace;
            font-size: 1.1em;
            color: #fff;
        }

        .copy-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #4CAF50;
            color: white;
            border-radius: 10px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            text-align: center;
            color: #FFC107;
            font-size: 1.2em;
            margin: 20px 0;
            display: none;
        }

        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }

            .button-group {
                grid-template-columns: 1fr;
            }

            .result-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AI XỔ SỐ MIỀN BẮC TRUNG NAM</h1>
        </div>

        <div class="control-panel">
            <div class="input-group">
                <label for="region">Chọn miền:</label>
                <select id="region">
                    <option value="Miền Bắc">Xổ Số Miền Bắc</option>
                    <option value="Miền Trung">Xổ Số Miền Trung</option>
                    <option value="Miền Nam">Xổ Số Miền Nam</option>
                    <option value="Lotto Ku">Lotto Ku</option>
                </select>
            </div>

            <div class="input-group">
                <label for="province">Chọn đài xổ số:</label>
                <select id="province"></select>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" id="startSimulation">Phân Tích & Dự Đoán</button>
            <button class="btn btn-secondary" id="refreshButton">Làm Mới</button>
            <button class="btn btn-danger" id="resetSpin">Reset Dữ Liệu</button>
        </div>

        <div class="statistics" id="statistics" style="display: none;">
            <h2>Thống Kê & Phân Tích</h2>
            <div class="stat-item">
                <span>Số hay về (Hot):</span>
                <span id="hotNumbersList"></span>
            </div>
            <div class="stat-item">
                <span>Số lâu chưa về (Cold):</span>
                <span id="coldNumbersList"></span>
            </div>
            <div class="stat-item">
                <span>Mẫu số thường xuất hiện:</span>
                <span id="patternsList"></span>
            </div>
        </div>

        <div class="loading" id="loading">Đang phân tích dữ liệu...</div>

        <div class="results" id="output" style="display: none;">
            <h2 class="result-title">Kết quả Xổ Số: <span id="provinceName"></span></h2>
            <div id="result">
                <!-- Kết quả sẽ được thêm vào đây -->
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Thêm code JavaScript từ phiên bản trước
        // [Code JavaScript giữ nguyên như cũ, chỉ thay đổi phần displayResults]

        // Hiển thị kết quả
function displayResults(gameType, numbers) {
    const resultDiv = document.getElementById('result');
    const statistics = document.getElementById('statistics');
    
    // Hiển thị thống kê
    statistics.style.display = 'block';
    document.getElementById('hotNumbersList').textContent = numberAnalyzer.getHotNumbers(gameType).join(', ');
    document.getElementById('coldNumbersList').textContent = numberAnalyzer.getColdNumbers(gameType).join(', ');
    
    const patterns = numberAnalyzer.findPatterns(gameType);
    document.getElementById('patternsList').textContent = 
        `Lặp lại: ${patterns.repeatedNumbers.join(', ')} | Dãy số: ${patterns.sequences.join(', ')}`;

    // Tạo các bộ số
    const ghep4D = numberGenerator.generateNumbers(gameType, 7).sort((a, b) => a - b);
    const ghep3D = numberGenerator.generateNumbers(gameType, 7).sort((a, b) => a - b);
    const dan2D = numberGenerator.generateNumbers(gameType, 64)
        .map(n => n.toString().padStart(2, '0'))
        .sort((a, b) => a - b);
    const mega645 = numberGenerator.generateNumbers('Mega 6/45', 6)
        .map(n => n.toString().padStart(2, '0'))
        .sort((a, b) => a - b);
    const power655 = numberGenerator.generateNumbers('Power 6/55', 6)
        .map(n => n.toString().padStart(2, '0'))
        .sort((a, b) => a - b);

    // Phân tích tần suất và tối ưu bộ số
    const optimizedResults = optimizeNumberSets({
        ghep4D,
        ghep3D,
        dan2D,
        mega645,
        power655
    }, patterns);

    // Hiển thị kết quả chi tiết
    resultDiv.innerHTML = `
        <div class="result-section">
            <h3>Kết Quả Phân Tích & Dự Đoán:</h3>
            
            <div class="number-set">
                <h4>Ghép 4D (Độ tin cậy: ${optimizedResults.confidence.ghep4D}%)</h4>
                <div class="number-grid">
                    ${optimizedResults.ghep4D.map(num => `
                        <div class="number-cell ${getNumberClass(num, patterns)}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
                <button class="copy-btn" onclick="copyText('${optimizedResults.ghep4D.join(',')}')">Copy</button>
            </div>

            <div class="number-set">
                <h4>Ghép 3D (Độ tin cậy: ${optimizedResults.confidence.ghep3D}%)</h4>
                <div class="number-grid">
                    ${optimizedResults.ghep3D.map(num => `
                        <div class="number-cell ${getNumberClass(num, patterns)}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
                <button class="copy-btn" onclick="copyText('${optimizedResults.ghep3D.join(',')}')">Copy</button>
            </div>

            <div class="number-set">
                <h4>Dàn 2D - 64 Số (Độ tin cậy: ${optimizedResults.confidence.dan2D}%)</h4>
                <div class="number-grid small">
                    ${optimizedResults.dan2D.map(num => `
                        <div class="number-cell ${getNumberClass(num, patterns)}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
                <button class="copy-btn" onclick="copyText('${optimizedResults.dan2D.join(',')}')">Copy</button>
            </div>

            <div class="number-set">
                <h4>Mega 6/45 (Độ tin cậy: ${optimizedResults.confidence.mega645}%)</h4>
                <div class="number-grid">
                    ${optimizedResults.mega645.map(num => `
                        <div class="number-cell ${getNumberClass(num, patterns)}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
                <button class="copy-btn" onclick="copyText('${optimizedResults.mega645.join(',')}')">Copy</button>
            </div>

            <div class="number-set">
                <h4>Power 6/55 (Độ tin cậy: ${optimizedResults.confidence.power655}%)</h4>
                <div class="number-grid">
                    ${optimizedResults.power655.map(num => `
                        <div class="number-cell ${getNumberClass(num, patterns)}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
                <button class="copy-btn" onclick="copyText('${optimizedResults.power655.join(',')}')">Copy</button>
            </div>
        </div>
    `;

    // Lưu kết quả vào lịch sử
    historyManager.saveResult(gameType, {
        ghep4D: optimizedResults.ghep4D,
        ghep3D: optimizedResults.ghep3D,
        dan2D: optimizedResults.dan2D,
        mega645: optimizedResults.mega645,
        power655: optimizedResults.power655,
        timestamp: new Date().getTime()
    });
}

// Hàm tối ưu bộ số
function optimizeNumberSets(numberSets, patterns) {
    const confidence = {
        ghep4D: calculateConfidence(numberSets.ghep4D, patterns),
        ghep3D: calculateConfidence(numberSets.ghep3D, patterns),
        dan2D: calculateConfidence(numberSets.dan2D, patterns),
        mega645: calculateConfidence(numberSets.mega645, patterns),
        power655: calculateConfidence(numberSets.power655, patterns)
    };

    return {
        ...numberSets,
        confidence
    };
}

// Tính độ tin cậy của bộ số
function calculateConfidence(numbers, patterns) {
    let score = 0;
    const totalNumbers = numbers.length;

    numbers.forEach(num => {
        // Kiểm tra số nóng
        if (patterns.repeatedNumbers.includes(num)) {
            score += 2;
        }

        // Kiểm tra chuỗi số
        if (patterns.sequences.includes(num)) {
            score += 1.5;
        }

        // Kiểm tra mẫu thống kê
        if (checkStatisticalPattern(num)) {
            score += 1;
        }
    });

    // Tính phần trăm độ tin cậy
    return Math.min(Math.round((score / (totalNumbers * 3)) * 100), 100);
}

// Kiểm tra mẫu thống kê
function checkStatisticalPattern(number) {
    // Thêm logic kiểm tra mẫu thống kê tại đây
    const num = parseInt(number);
    
    // Kiểm tra số đẹp
    if (/^(\d)\1+$/.test(number)) return true; // Số lặp
    if (/^(?:01|12|23|34|45|56|67|78|89|90)$/.test(number)) return true; // Số tiến
    if (/^(?:09|98|87|76|65|54|43|32|21|10)$/.test(number)) return true; // Số lùi

    // Kiểm tra tổng chữ số
    const digitSum = number.toString().split('').reduce((sum, digit) => sum + parseInt(digit), 0);
    if (digitSum === 9 || digitSum === 7) return true; // Số tổng 9 hoặc 7 được coi là đẹp

    return false;
}

// Xác định class cho số
function getNumberClass(number, patterns) {
    const classes = [];
    
    if (patterns.repeatedNumbers.includes(number)) {
        classes.push('hot-number');
    }
    if (patterns.sequences.includes(number)) {
        classes.push('sequence-number');
    }
    if (checkStatisticalPattern(number)) {
        classes.push('pattern-number');
    }

    return classes.join(' ');
}

// Thêm CSS cho các class mới
const style = document.createElement('style');
style.textContent = `
    .number-set {
        margin-bottom: 30px;
        background: rgba(255, 255, 255, 0.05);
        padding: 20px;
        border-radius: 10px;
    }

    .number-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        gap: 10px;
        margin: 15px 0;
    }

    .number-grid.small {
        grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
    }

    .number-cell {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
        transition: all 0.3s ease;
    }

    .hot-number {
        background: rgba(255, 87, 87, 0.3);
        color: #fff;
    }

    .sequence-number {
        background: rgba(87, 87, 255, 0.3);
        color: #fff;
    }

    .pattern-number {
        background: rgba(87, 255, 87, 0.3);
        color: #fff;
    }

    .copy-btn {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .copy-btn:hover {
        background: #45a049;
        transform: translateY(-2px);
    }
`;

document.head.appendChild(style);
