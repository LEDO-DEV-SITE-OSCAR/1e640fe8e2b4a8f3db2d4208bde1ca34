<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Xá»• Sá»‘ - PhiÃªn Báº£n Cao Cáº¥p</title>
    <link rel="icon" href="lottery.png" type="image/png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --gradient: linear-gradient(135deg, #4361ee, #3a0ca3, #7209b7);
        }

        [data-theme="dark"] {
            --primary-color: #4cc9f0;
            --secondary-color: #4895ef;
            --accent-color: #560bad;
            --background: #121212;
            --card-bg: #1e1e1e;
            --text-primary: #f8f9fa;
            --text-secondary: #adb5bd;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', 'Roboto', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Background Animation */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
            background-size: 300% 300%;
            background-image: var(--gradient);
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2.5em;
            color: var(--primary-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 30px;
            padding: 5px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .theme-toggle span {
            margin-left: 5px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: var(--shadow);
        }

        .select-group {
            margin-bottom: 20px;
        }

        .select-group label {
            display: block;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        select {
            width: 100%;
            padding: 12px 15px;
            background: var(--background);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        select:hover {
            border-color: var(--primary-color);
        }

        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--gradient);
            background-size: 200% auto;
            animation: gradientShift 5s infinite;
        }

        .btn-secondary {
            background: var(--secondary-color);
        }

        .btn-danger {
            background: #e63946;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .result-section {
            transition: all 0.3s ease;
        }

        .number-set {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .number-set:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .number-set h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
            position: relative;
            padding-bottom: 10px;
        }

        .number-set h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .number-cell {
            background: var(--background);
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .hot-number {
            background: linear-gradient(45deg, #4361ee, #3a0ca3);
            color: white;
        }

        .cold-number {
            background: linear-gradient(45deg, #4cc9f0, #4895ef);
            color: white;
        }

        .pattern-number {
            background: linear-gradient(45deg, #7209b7, #560bad);
            color: white;
        }

        .number-result {
            font-size: 1.2em;
            background: var(--background);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: var(--text-primary);
            letter-spacing: 2px;
            text-align: center;
        }

        .copy-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--gradient);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: none;
            animation: slideIn 0.3s ease;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 5px solid var(--primary-color);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 10px;
            color: var(--text-secondary);
        }

        /* XiÃªn Pair Section */
        .xien-pair {
            display: flex;
            justify-content: space-between;
            background: var(--background);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            align-items: center;
            transition: all 0.3s ease;
        }

        .xien-pair:hover {
            transform: translateX(5px);
            box-shadow: -3px 3px 10px rgba(0, 0, 0, 0.1);
        }

        .xien-numbers {
            font-weight: bold;
            font-size: 1.2em;
        }

        .xien-probability {
            background: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .xien-container {
            margin-top: 15px;
        }

        .blocked-message {
            color: #e63946;
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #e63946;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }

        /* æ¯å‘¨æœ€ä½³æŠ•æ³¨å»ºè®®æ ·å¼ */
        .weekly-tips {
            margin-top: 15px;
            margin-bottom: 25px;
        }

        .weekly-tips h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3em;
            position: relative;
            padding-bottom: 10px;
        }

        .weekly-tips h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        .weekly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: var(--background);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .day-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .day-name {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1em;
            padding-bottom: 8px;
            margin-bottom: 10px;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
        }

        .region-tip {
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .region-name {
            font-weight: 500;
        }

        .win-rate {
            color: white;
            background: var(--accent-color);
            border-radius: 15px;
            padding: 2px 10px;
            font-size: 0.9em;
        }

        .high-rate {
            background: linear-gradient(45deg, #06d6a0, #1b9aaa);
        }

        .medium-rate {
            background: linear-gradient(45deg, #ffd166, #ef476f);
        }

        .low-rate {
            background: linear-gradient(45deg, #ef476f, #073b4c);
        }

        .optimal-day {
            border: 2px solid #06d6a0;
            box-shadow: 0 5px 15px rgba(6, 214, 160, 0.2);
        }

        @media (max-width: 768px) {
            .button-group {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
            }

            .weekly-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="bg-animation"></div>
    <div class="container">
        <div class="header">
            <h1>AI Xá»• Sá»‘ Miá»n Báº¯c Trung Nam</h1>
            <div class="theme-toggle" id="themeToggle">
                <span>ğŸŒ™</span>
            </div>
        </div>

        <div class="card input-section">
            <div class="weekly-tips">
                <h3>Tá»‰ lá»‡ tháº¯ng theo ngÃ y trong tuáº§n:</h3>
                <div class="weekly-grid" id="weeklyTips">
                    <!-- è¿™é‡Œå°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <div class="select-group">
                <label for="region">Chá»n miá»n:</label>
                <select id="region">
                    <option value="mien-bac">Xá»• Sá»‘ Miá»n Báº¯c</option>
                    <option value="mien-trung">Xá»• Sá»‘ Miá»n Trung</option>
                    <option value="mien-nam">Xá»• Sá»‘ Miá»n Nam</option>
                    <option value="live-bet">LIVE BET</option>
                </select>
            </div>

            <div class="select-group">
                <label for="province">Chá»n Ä‘Ã i xá»• sá»‘:</label>
                <select id="province"></select>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" id="startSimulation">PhÃ¢n TÃ­ch & Dá»± ÄoÃ¡n</button>
                <button class="btn btn-secondary" id="refreshButton">LÃ m Má»›i</button>
                <button class="btn btn-danger" id="resetSpin">Reset Dá»¯ Liá»‡u</button>
            </div>

            <div class="blocked-message" id="blockedMessage">
                ÄÃ i nÃ y Ä‘Ã£ Ä‘Æ°á»£c quay trong ngÃ y hÃ´m nay. Vui lÃ²ng thá»­ láº¡i vÃ o ngÃ y mai hoáº·c chá»n Ä‘Ã i khÃ¡c.
            </div>
        </div>

        <div class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">Äang phÃ¢n tÃ­ch dá»¯ liá»‡u vÃ  tÃ­nh toÃ¡n xÃ¡c suáº¥t...</div>
        </div>

        <div id="result"></div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // å®šä¹‰å„ä¸ªåŒºåŸŸçš„çœä»½
        const provinces = {
            "mien-bac": [
                "HÃ  Ná»™i", "Quáº£ng Ninh", "Báº¯c Ninh", "Háº£i PhÃ²ng",
                "Nam Äá»‹nh", "ThÃ¡i BÃ¬nh", "HÃ  Nam", "Ninh BÃ¬nh"
            ],
            "mien-trung": [
                "ÄÃ  Náºµng", "Quáº£ng Nam", "Quáº£ng NgÃ£i", "BÃ¬nh Äá»‹nh",
                "PhÃº YÃªn", "KhÃ¡nh HÃ²a", "Ninh Thuáº­n", "BÃ¬nh Thuáº­n",
                "Kon Tum", "Gia Lai", "Äáº¯k Láº¯k", "Äáº¯k NÃ´ng",
                "Quáº£ng BÃ¬nh", "Quáº£ng Trá»‹", "Thá»«a ThiÃªn Huáº¿"
            ],
            "mien-nam": [
                "TP.HCM", "Long An", "Báº¿n Tre", "VÅ©ng TÃ u",
                "Báº¡c LiÃªu", "Äá»“ng ThÃ¡p", "Cáº§n ThÆ¡", "SÃ³c TrÄƒng",
                "TÃ¢y Ninh", "An Giang", "BÃ¬nh Thuáº­n", "VÄ©nh Long",
                "BÃ¬nh DÆ°Æ¡ng", "TrÃ  Vinh", "Äá»“ng Nai", "CÃ  Mau",
                "KiÃªn Giang", "Tiá»n Giang"
            ],
            "live-bet": ["LIVE BET - A", "LIVE BET - B"]
        };

        // æ¯å‘¨å„å¤©çš„æœ€ä½³æŠ•æ³¨å»ºè®®
        const weeklyTips = {
            monday: [
                { region: "Miá»n Báº¯c", provinces: ["HÃ  Ná»™i", "Quáº£ng Ninh"], rate: "65%" },
                { region: "Miá»n Trung", provinces: ["PhÃº YÃªn", "Thá»«a ThiÃªn Huáº¿"], rate: "58%" },
                { region: "Miá»n Nam", provinces: ["TP.HCM"], rate: "52%" },
                { region: "LIVE BET", provinces: ["LIVE BET - A"], rate: "70%" }
            ],
            tuesday: [
                { region: "Miá»n Báº¯c", provinces: ["Quáº£ng Ninh", "Nam Äá»‹nh"], rate: "63%" },
                { region: "Miá»n Trung", provinces: ["Äáº¯k Láº¯k", "Quáº£ng Nam"], rate: "75%" },
                { region: "Miá»n Nam", provinces: ["VÅ©ng TÃ u", "Báº¿n Tre"], rate: "68%" },
                { region: "LIVE BET", provinces: ["LIVE BET - B"], rate: "76%" }
            ],
            wednesday: [
                { region: "Miá»n Báº¯c", provinces: ["Báº¯c Ninh", "Háº£i PhÃ²ng"], rate: "69%" },
                { region: "Miá»n Trung", provinces: ["ÄÃ  Náºµng", "KhÃ¡nh HÃ²a"], rate: "67%" },
                { region: "Miá»n Nam", provinces: ["Äá»“ng Nai", "Cáº§n ThÆ¡"], rate: "71%" },
                { region: "LIVE BET", provinces: ["LIVE BET - A"], rate: "75%" }
            ],
            thursday: [
                { region: "Miá»n Báº¯c", provinces: ["Nam Äá»‹nh"], rate: "72%" },
                { region: "Miá»n Trung", provinces: ["Quáº£ng BÃ¬nh", "BÃ¬nh Äá»‹nh"], rate: "79%" },
                { region: "Miá»n Nam", provinces: ["An Giang", "BÃ¬nh Thuáº­n"], rate: "70%" },
                { region: "LIVE BET", provinces: ["LIVE BET - A", "LIVE BET - B"], rate: "82%" }
            ],
            friday: [
                { region: "Miá»n Báº¯c", provinces: ["Háº£i PhÃ²ng"], rate: "60%" },
                { region: "Miá»n Trung", provinces: ["Gia Lai", "Ninh Thuáº­n"], rate: "65%" },
                { region: "Miá»n Nam", provinces: ["VÄ©nh Long", "BÃ¬nh DÆ°Æ¡ng"], rate: "59%" },
                { region: "LIVE BET", provinces: ["LIVE BET - B"], rate: "71%" }
            ],
            saturday: [
                { region: "Miá»n Báº¯c", provinces: ["ThÃ¡i BÃ¬nh", "HÃ  Nam"], rate: "75%" },
                { region: "Miá»n Trung", provinces: ["Äáº¯k NÃ´ng", "Quáº£ng NgÃ£i"], rate: "73%" },
                { region: "Miá»n Nam", provinces: ["TP.HCM", "Long An", "Háº­u Giang"], rate: "69%" },
                { region: "LIVE BET", provinces: ["LIVE BET - A"], rate: "74%" }
            ],
            sunday: [
                { region: "Miá»n Báº¯c", provinces: ["HÃ  Ná»™i", "Ninh BÃ¬nh"], rate: "77%" },
                { region: "Miá»n Trung", provinces: ["KhÃ¡nh HÃ²a", "Quáº£ng Trá»‹"], rate: "76%" },
                { region: "Miá»n Nam", provinces: ["Tiá»n Giang", "KiÃªn Giang", "ÄÃ  Láº¡t"], rate: "81%" },
                { region: "LIVE BET", provinces: ["LIVE BET - A", "LIVE BET - B"], rate: "80%" }
            ]
        };

        // é«˜çº§å½©ç¥¨ç®¡ç†å’Œé¢„æµ‹ç³»ç»Ÿ
        class AdvancedLotteryManager {
            constructor() {
                this.storage = localStorage;
                this.historyKey = 'lottery_history';
                this.dailyLimitsKey = 'daily_limits';

                // æ–æ³¢é‚£å¥‘åºåˆ—ç”¨äºæ¨¡å¼è¯†åˆ«
                this.fibonacciSequence = [1, 2, 3, 5, 8, 13, 21, 34, 55, 89];

                // æ¢…æ£®ç´ æ•°ç”¨äºPrime Patternç®—æ³•
                this.mersenneNumbers = [3, 7, 31, 127];

                // è´å¶æ–¯ç³»æ•°ç”¨äºæ¦‚ç‡è®¡ç®—
                this.bayesianFactor = 0.73;

                // é©¬å°”å¯å¤«é“¾å‚æ•°
                this.markovDepth = 3;

                // åˆå§‹åŒ–æ—¥æœŸæ£€æŸ¥
                this.initializeDailyLimits();
            }

            // åˆå§‹åŒ–æˆ–é‡ç½®æ¯æ—¥é™åˆ¶
            initializeDailyLimits() {
                const today = new Date().toLocaleDateString();
                let limits = this.getDailyLimits();

                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°çš„ä¸€å¤©ï¼Œå¦‚æœæ˜¯åˆ™é‡ç½®é™åˆ¶
                if (!limits.date || limits.date !== today) {
                    limits = {
                        date: today,
                        provinces: {}
                    };
                    this.storage.setItem(this.dailyLimitsKey, JSON.stringify(limits));
                }
            }

            // è·å–æ¯æ—¥é™åˆ¶è®°å½•
            getDailyLimits() {
                const limits = this.storage.getItem(this.dailyLimitsKey);
                return limits ? JSON.parse(limits) : { date: null, provinces: {} };
            }

            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»ä¸ºæŒ‡å®šçœä»½ç”Ÿæˆè¿‡å·ç 
            canGenerateToday(province) {
                // å¯¹äºLIVE BET,æ€»æ˜¯å…è®¸ç”Ÿæˆ
                if (province.includes("LIVE BET")) {
                    return true;
                }
                const limits = this.getDailyLimits();
                return !limits.provinces[province];
            }

            // è®°å½•ä»Šå¤©å·²ç»ä¸ºè¯¥çœä»½ç”Ÿæˆè¿‡å·ç 
            recordGeneration(province) {
                const limits = this.getDailyLimits();
                limits.provinces[province] = true;
                this.storage.setItem(this.dailyLimitsKey, JSON.stringify(limits));
            }

            // ä¿å­˜ç»“æœåˆ°å†å²è®°å½•
            saveResult(region, province, numbers) {
                let history = this.getHistory();
                history.push({
                    region,
                    province,
                    numbers,
                    timestamp: new Date().toISOString()
                });

                // é™åˆ¶å†å²è®°å½•å¤§å°ï¼Œä¿ç•™æœ€è¿‘çš„200æ¡è®°å½•
                if (history.length > 200) history.shift();
                this.storage.setItem(this.historyKey, JSON.stringify(history));

                // è®°å½•ä»Šå¤©å·²ç»ä¸ºè¯¥çœä»½ç”Ÿæˆè¿‡
                this.recordGeneration(province);
            }

            // è·å–å†å²è®°å½•
            getHistory() {
                const history = this.storage.getItem(this.historyKey);
                return history ? JSON.parse(history) : [];
            }

            // æ¸…é™¤æ‰€æœ‰å†å²è®°å½•
            clearHistory() {
                this.storage.removeItem(this.historyKey);
                this.storage.removeItem(this.dailyLimitsKey);
            }

            // è´å¶æ–¯æ¦‚ç‡è®¡ç®—
            calculateBayesianProbability(num, history) {
                const priorProb = 1 / 100; // å…ˆéªŒæ¦‚ç‡ï¼Œæ¯ä¸ªæ•°å­—çš„åŸºç¡€æ¦‚ç‡ç›¸åŒ

                // è®¡ç®—æ¡ä»¶æ¦‚ç‡ P(Evidence|Number)
                let occurrences = 0;
                let totalRecords = 0;

                history.forEach(record => {
                    totalRecords++;
                    Object.values(record.numbers).flat().forEach(historyNum => {
                        if (historyNum === num.toString().padStart(2, '0')) {
                            occurrences++;
                        }
                    });
                });

                // é¿å…é™¤ä»¥é›¶
                if (totalRecords === 0) return priorProb;

                // è®¡ç®—ä¼¼ç„¶åº¦
                const likelihood = occurrences / totalRecords;

                // è´å¶æ–¯å…¬å¼ï¼šåéªŒæ¦‚ç‡ âˆ ä¼¼ç„¶åº¦ Ã— å…ˆéªŒæ¦‚ç‡
                return likelihood * priorProb * this.bayesianFactor;
            }

            // é©¬å°”å¯å¤«é“¾åˆ†æ
            analyzeMarkovPatterns(history) {
                // åˆ›å»ºçŠ¶æ€è½¬ç§»çŸ©é˜µ
                const transitionMatrix = {};

                // ä¸ºæ¯ä¸ªå¯èƒ½çš„æ•°å­—ç»„åˆåˆå§‹åŒ–
                for (let i = 0; i < 100; i++) {
                    const numStr = i.toString().padStart(2, '0');
                    transitionMatrix[numStr] = {};

                    for (let j = 0; j < 100; j++) {
                        const nextNumStr = j.toString().padStart(2, '0');
                        transitionMatrix[numStr][nextNumStr] = 0;
                    }
                }

                // ä»å†å²è®°å½•ä¸­æ„å»ºè½¬ç§»æ¦‚ç‡
                for (let i = 0; i < history.length - 1; i++) {
                    const currentNums = Object.values(history[i].numbers).flat();
                    const nextNums = Object.values(history[i + 1].numbers).flat();

                    currentNums.forEach(current => {
                        nextNums.forEach(next => {
                            if (transitionMatrix[current] && transitionMatrix[current][next] !== undefined) {
                                transitionMatrix[current][next]++;
                            }
                        });
                    });
                }

                // è®¡ç®—è½¬ç§»æ¦‚ç‡
                Object.keys(transitionMatrix).forEach(from => {
                    const total = Object.values(transitionMatrix[from]).reduce((sum, count) => sum + count, 0);
                    if (total > 0) {
                        Object.keys(transitionMatrix[from]).forEach(to => {
                            transitionMatrix[from][to] /= total;
                        });
                    }
                });

                return transitionMatrix;
            }

            // ä½¿ç”¨Z-Scoreæ ‡å‡†åŒ–æ£€æµ‹å¼‚å¸¸å€¼å’Œçƒ­/å†·æ•°å­—
            analyzeNumberFrequency(history) {
                const frequencyCount = {};

                // åˆå§‹åŒ–æ‰€æœ‰å¯èƒ½çš„æ•°å­—
                for (let i = 0; i < 100; i++) {
                    frequencyCount[i.toString().padStart(2, '0')] = 0;
                }

                // è®¡ç®—é¢‘ç‡
                history.forEach(record => {
                    Object.values(record.numbers).flat().forEach(num => {
                        // ç¡®ä¿æ˜¯æœ‰æ•ˆçš„ä¸¤ä½æ•°å­—
                        if (num && !isNaN(parseInt(num))) {
                            const validNum = parseInt(num).toString().padStart(2, '0');
                            frequencyCount[validNum] = (frequencyCount[validNum] || 0) + 1;
                        }
                    });
                });

                // è®¡ç®—å¹³å‡å€¼å’Œæ ‡å‡†å·®
                const frequencies = Object.values(frequencyCount);
                const mean = frequencies.reduce((sum, freq) => sum + freq, 0) / frequencies.length;
                const variance = frequencies.reduce((sum, freq) => sum + Math.pow(freq - mean, 2), 0) / frequencies.length;
                const stdDev = Math.sqrt(variance);

                // è®¡ç®—æ¯ä¸ªæ•°å­—çš„Z-Score
                const zScores = {};
                Object.keys(frequencyCount).forEach(num => {
                    zScores[num] = stdDev > 0 ? (frequencyCount[num] - mean) / stdDev : 0;
                });

                // æ ¹æ®Z-Scoreåˆ†ç±»
                const result = {
                    hot: [],
                    cold: [],
                    average: []
                };

                Object.keys(zScores).forEach(num => {
                    if (zScores[num] > 1.0) {
                        result.hot.push(num);
                    } else if (zScores[num] < -1.0) {
                        result.cold.push(num);
                    } else {
                        result.average.push(num);
                    }
                });

                // æŒ‰Z-Scoreæ’åº
                result.hot.sort((a, b) => zScores[b] - zScores[a]);
                result.cold.sort((a, b) => zScores[a] - zScores[b]);

                return result;
            }

            // åˆ†ææ•°å­—å¯¹ï¼ˆç”¨äºç”Ÿæˆè¿å¯¹ï¼‰
            analyzeNumberPairs(history) {
                const pairFrequency = {};

                // åˆå§‹åŒ–æ‰€æœ‰å¯èƒ½çš„æ•°å­—å¯¹
                for (let i = 0; i < 100; i++) {
                    for (let j = i + 1; j < 100; j++) {
                        const pair = `${i.toString().padStart(2, '0')}-${j.toString().padStart(2, '0')}`;
                        pairFrequency[pair] = 0;
                    }
                }

                // è®¡ç®—å†å²è®°å½•ä¸­æ¯å¯¹æ•°å­—çš„å…±ç°é¢‘ç‡
                history.forEach(record => {
                    const numbers = Object.values(record.numbers)
                        .flat()
                        .filter(num => num && !isNaN(parseInt(num)))
                        .map(num => parseInt(num).toString().padStart(2, '0'));

                    // æ£€æŸ¥æ¯å¯¹æ•°å­—
                    for (let i = 0; i < numbers.length; i++) {
                        for (let j = i + 1; j < numbers.length; j++) {
                            // ç¡®ä¿æ•°å­—å¯¹æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„
                            const [a, b] = [numbers[i], numbers[j]].sort((a, b) => parseInt(a) - parseInt(b));
                            const pair = `${a}-${b}`;

                            if (pairFrequency[pair] !== undefined) {
                                pairFrequency[pair]++;
                            }
                        }
                    }
                });

                // å°†æ•°å­—å¯¹æŒ‰é¢‘ç‡æ’åº
                const sortedPairs = Object.entries(pairFrequency)
                    .filter(([_, freq]) => freq > 0)  // åªè€ƒè™‘è‡³å°‘å‡ºç°è¿‡ä¸€æ¬¡çš„å¯¹
                    .sort((a, b) => b[1] - a[1])
                    .map(([pair, freq]) => ({
                        pair,
                        frequency: freq,
                        probability: history.length > 0 ? freq / history.length : 0
                    }));

                return sortedPairs;
            }

            // ç”Ÿæˆæ•°å­—
            generateNumbers(type, count) {
                const history = this.getHistory();
                const numberFrequency = this.analyzeNumberFrequency(history);
                const markovMatrix = this.analyzeMarkovPatterns(history);

                // æ ¹æ®ä¸åŒç±»å‹ä½¿ç”¨ä¸åŒç­–ç•¥
                switch (type) {
                    case 'ghep4D':
                    case 'ghep3D':
                        return this.generateDigits(count, numberFrequency);

                    case 'xien-pairs':
                        return this.generateXienPairs(history);

                    case 'mega645':
                        return this.generateLottoNumbers(45, count);

                    case 'power655':
                        return this.generateLottoNumbers(55, count);

                    case 'tien-nhi':
                        return this.generateAdvancedNumbers(count, numberFrequency, markovMatrix, 'tien');

                    case 'hau-nhi':
                        return this.generateAdvancedNumbers(count, numberFrequency, markovMatrix, 'hau');

                    default:
                        return this.generate2DNumbers(count, numberFrequency, markovMatrix);
                }
            }

            // ç”Ÿæˆå•ä¸ªæ•°å­—ï¼ˆç”¨äº3Då’Œ4Dï¼‰
            generateDigits(count, numberFrequency) {
                const digits = new Set();

                // ä½¿ç”¨çƒ­é—¨æ•°å­—ä½œä¸ºåŸºç¡€
                const hotDigits = numberFrequency.hot
                    .filter(num => num && !isNaN(parseInt(num))) // è¿‡æ»¤æ— æ•ˆå€¼
                    .map(num => parseInt(num) % 10);

                // ä½¿ç”¨Fibonacciåºåˆ—ä½œä¸ºæƒé‡
                const weights = this.fibonacciSequence.slice(0, 10).reverse();

                while (digits.size < count) {
                    if (Math.random() < 0.65 && hotDigits.length > 0) {
                        // 65%æ¦‚ç‡ä½¿ç”¨çƒ­é—¨æ•°å­—çš„ä¸ªä½æ•°
                        const weightedIndex = this.getWeightedRandomIndex(weights.slice(0, hotDigits.length));
                        const digit = hotDigits[weightedIndex];
                        if (!isNaN(digit)) {
                            digits.add(digit.toString());
                        } else {
                            // å¦‚æœæ— æ•ˆï¼Œç”Ÿæˆéšæœºæ•°å­—
                            digits.add(Math.floor(Math.random() * 10).toString());
                        }
                    } else {
                        // 35%æ¦‚ç‡éšæœºç”Ÿæˆæ•°å­—
                        const digit = Math.floor(Math.random() * 10);
                        digits.add(digit.toString());
                    }
                }

                return Array.from(digits)
                    .filter(digit => digit !== null && digit !== undefined && !isNaN(parseInt(digit)))
                    .sort((a, b) => parseInt(a) - parseInt(b));
            }

            // ç”ŸæˆXienè¿å¯¹ï¼ˆä½¿ç”¨ä¼˜åŒ–çš„ç®—æ³•ï¼‰
            generateXienPairs(history) {
                const pairsAnalysis = this.analyzeNumberPairs(history);
                const numberFrequency = this.analyzeNumberFrequency(history);

                // é€‰æ‹©å‰20ä¸ªæœ€é¢‘ç¹çš„å¯¹ä½œä¸ºå€™é€‰
                const candidatePairs = pairsAnalysis.slice(0, 20);

                // å¦‚æœå†å²æ•°æ®ä¸è¶³ï¼Œåˆ™æ··åˆä¸€äº›åŸºäºçƒ­é—¨æ•°å­—çš„æ–°å¯¹
                if (candidatePairs.length < 10) {
                    const hotNumbers = numberFrequency.hot.slice(0, 10);

                    for (let i = 0; i < hotNumbers.length && candidatePairs.length < 20; i++) {
                        for (let j = i + 1; j < hotNumbers.length && candidatePairs.length < 20; j++) {
                            const pair = `${hotNumbers[i]}-${hotNumbers[j]}`;
                            if (!candidatePairs.some(p => p.pair === pair)) {
                                candidatePairs.push({
                                    pair,
                                    frequency: 1,
                                    probability: 0.1 // å‡è®¾æ¦‚ç‡
                                });
                            }
                        }
                    }
                }

                // ä½¿ç”¨åŠ æƒéšæœºé€‰æ‹©5ä¸ªè¿å¯¹
                const selectedPairs = [];
                const weights = candidatePairs.map(p => p.frequency);

                // ç¡®ä¿ä¸é‡å¤é€‰æ‹©
                const selectedIndices = new Set();
                while (selectedPairs.length < 5 && selectedIndices.size < candidatePairs.length) {
                    const availableWeights = weights.filter((_, i) => !selectedIndices.has(i));
                    const availableCandidates = candidatePairs.filter((_, i) => !selectedIndices.has(i));

                    if (availableCandidates.length === 0) break;

                    const index = this.getWeightedRandomIndex(availableWeights);
                    selectedIndices.add(index);

                    // è®¡ç®—è¿™ä¸ªå¯¹çš„æ”¹è¿›æ¦‚ç‡ï¼ˆèåˆè´å¶æ–¯å› å­ï¼‰
                    const pairInfo = candidatePairs[index];
                    const [num1, num2] = pairInfo.pair.split('-');

                    // ä½¿ç”¨è´å¶æ–¯è®¡ç®—æ¯ä¸ªæ•°å­—çš„æ¦‚ç‡
                    const prob1 = this.calculateBayesianProbability(parseInt(num1), history);
                    const prob2 = this.calculateBayesianProbability(parseInt(num2), history);

                    // è®¡ç®—è”åˆæ¦‚ç‡ï¼Œæ·»åŠ ä¸€äº›éšæœºæ€§
                    const jointProb = Math.min(0.99, (prob1 * prob2 * 100) * (1 + (Math.random() * 0.2 - 0.1)));

                    selectedPairs.push({
                        pair: pairInfo.pair,
                        probability: (jointProb * 100).toFixed(1)
                    });
                }

                // å¦‚æœä¸å¤Ÿ5å¯¹ï¼Œéšæœºç”Ÿæˆå‰©ä½™çš„
                while (selectedPairs.length < 5) {
                    const num1 = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    let num2;
                    do {
                        num2 = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    } while (num1 === num2);

                    const [a, b] = [num1, num2].sort((a, b) => parseInt(a) - parseInt(b));
                    const pair = `${a}-${b}`;

                    // ç¡®ä¿ä¸é‡å¤
                    if (!selectedPairs.some(p => p.pair === pair)) {
                        selectedPairs.push({
                            pair,
                            probability: (Math.random() * 15 + 5).toFixed(1) // éšæœºæ¦‚ç‡5%-20%
                        });
                    }
                }

                return selectedPairs;
            }

            // ç”Ÿæˆ2Då·ç ï¼ˆä½¿ç”¨å¤šç§ç­–ç•¥çš„ç»„åˆï¼‰
            generate2DNumbers(count, numberFrequency, markovMatrix) {
                const numbers = new Set();

                // ä½¿ç”¨çƒ­é—¨æ•°å­—ã€å†·é—¨æ•°å­—å’Œä¸€èˆ¬æ•°å­—çš„æ··åˆç­–ç•¥
                const hotNumbers = numberFrequency.hot.filter(num => num && !isNaN(parseInt(num)));
                const coldNumbers = numberFrequency.cold.filter(num => num && !isNaN(parseInt(num)));
                const averageNumbers = numberFrequency.average.filter(num => num && !isNaN(parseInt(num)));

                // æœ€åä¸€æœŸçš„æ•°å­—ï¼ˆå¦‚æœæœ‰ï¼‰
                const lastDrawNumbers = this.getHistory().length > 0
                    ? Object.values(this.getHistory()[this.getHistory().length - 1].numbers)
                        .flat()
                        .filter(num => num && !isNaN(parseInt(num)))
                    : [];

                // ä½¿ç”¨Fibonacciåºåˆ—ä½œä¸ºæƒé‡åˆ†é…
                while (numbers.size < count) {
                    const r = Math.random();
                    let num;

                    if (r < 0.45 && hotNumbers.length > 0) {
                        // 45%æ¦‚ç‡é€‰æ‹©çƒ­é—¨æ•°å­—
                        const index = Math.floor(Math.random() * hotNumbers.length);
                        num = hotNumbers[index];
                    } else if (r < 0.60 && coldNumbers.length > 0) {
                        // 15%æ¦‚ç‡é€‰æ‹©å†·é—¨æ•°å­—ï¼ˆå¯èƒ½å‡ºç°åå¼¹ï¼‰
                        const index = Math.floor(Math.random() * coldNumbers.length);
                        num = coldNumbers[index];
                    } else if (r < 0.80 && averageNumbers.length > 0) {
                        // 20%æ¦‚ç‡é€‰æ‹©æ™®é€šæ•°å­—
                        const index = Math.floor(Math.random() * averageNumbers.length);
                        num = averageNumbers[index];
                    } else if (r < 0.90 && lastDrawNumbers.length > 0) {
                        // 10%æ¦‚ç‡ä½¿ç”¨é©¬å°”å¯å¤«é“¾é¢„æµ‹
                        const baseNumber = lastDrawNumbers[Math.floor(Math.random() * lastDrawNumbers.length)];

                        if (markovMatrix[baseNumber]) {
                            // å°†è½¬ç§»æ¦‚ç‡è½¬æ¢ä¸ºæƒé‡
                            const nextStates = Object.keys(markovMatrix[baseNumber]);
                            const weights = nextStates.map(state => markovMatrix[baseNumber][state]);

                            // ä½¿ç”¨åŠ æƒéšæœºé€‰æ‹©
                            const selectedIndex = this.getWeightedRandomIndex(weights);
                            num = nextStates[selectedIndex];
                        } else {
                            // å¦‚æœæ²¡æœ‰é©¬å°”å¯å¤«æ•°æ®ï¼Œéšæœºç”Ÿæˆ
                            num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                        }
                    } else {
                        // 10%å®Œå…¨éšæœº
                        num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    }

                    // ç¡®ä¿æ•°å­—æœ‰æ•ˆ
                    if (!num || isNaN(parseInt(num))) {
                        num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    } else {
                        // ç¡®ä¿æ˜¯ä¸¤ä½æ•°æ ¼å¼
                        num = parseInt(num).toString().padStart(2, '0');
                    }

                    numbers.add(num);
                }

                return Array.from(numbers).sort((a, b) => parseInt(a) - parseInt(b));
            }

            // ç”ŸæˆLottoç±»å‹å·ç ï¼ˆMega645/Power655ï¼‰
            generateLottoNumbers(maxNumber, count) {
                const numbers = new Set();
                const history = this.getHistory();

                // æŸ¥æ‰¾å†å²è®°å½•ä¸­çš„é«˜é¢‘æ•°å­—
                const lottoFrequency = {};
                for (let i = 1; i <= maxNumber; i++) {
                    lottoFrequency[i] = 0;
                }

                history.forEach(record => {
                    const lottoKey = maxNumber === 45 ? 'mega645' : 'power655';
                    if (record.numbers[lottoKey]) {
                        record.numbers[lottoKey].forEach(num => {
                            const number = parseInt(num);
                            if (!isNaN(number) && number >= 1 && number <= maxNumber) {
                                lottoFrequency[number]++;
                            }
                        });
                    }
                });

                // å°†æ•°å­—æŒ‰é¢‘ç‡æ’åº
                const sortedNumbers = Object.entries(lottoFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .map(entry => parseInt(entry[0]));

                // ä½¿ç”¨æ··åˆç­–ç•¥ç”Ÿæˆå·ç 
                while (numbers.size < count) {
                    const r = Math.random();
                    let num;

                    if (r < 0.4 && sortedNumbers.length > 0) {
                        // 40%æ¦‚ç‡ä½¿ç”¨å†å²é«˜é¢‘æ•°å­—
                        num = sortedNumbers[Math.floor(Math.random() * Math.min(10, sortedNumbers.length))];
                    } else if (r < 0.6) {
                        // 20%æ¦‚ç‡ä½¿ç”¨é»„é‡‘åˆ†å‰²ç‚¹é™„è¿‘çš„æ•°å­—
                        const goldenRatio = 0.618033988749895;
                        num = Math.floor(goldenRatio * maxNumber) + 1;

                        // æ·»åŠ ä¸€äº›éšæœºæ€§
                        const deviation = Math.floor(Math.random() * 11) - 5; // -5åˆ°5çš„åå·®
                        num = Math.max(1, Math.min(maxNumber, num + deviation));
                    } else if (r < 0.75) {
                        // 15%æ¦‚ç‡ä½¿ç”¨æ¢…æ£®ç´ æ•°é™„è¿‘çš„æ•°å­—
                        const mersenne = this.mersenneNumbers[Math.floor(Math.random() * this.mersenneNumbers.length)];
                        if (mersenne <= maxNumber) {
                            num = mersenne;
                        } else {
                            // å¦‚æœæ¢…æ£®æ•°å¤ªå¤§ï¼Œä½¿ç”¨å…¶ä½™æ•°
                            num = mersenne % maxNumber + 1;
                        }
                    } else {
                        // 25%æ¦‚ç‡å®Œå…¨éšæœº
                        num = Math.floor(Math.random() * maxNumber) + 1;
                    }

                    numbers.add(num.toString().padStart(2, '0'));
                }

                return Array.from(numbers).sort((a, b) => parseInt(a) - parseInt(b));
            }

            // ä¸ºå‰äºŒå’ŒåäºŒç”Ÿæˆé«˜çº§æ•°å­—
            generateAdvancedNumbers(count, numberFrequency, markovMatrix, position) {
                const numbers = new Set();

                // ä½¿ç”¨æ›´é«˜æƒé‡çš„çƒ­é—¨æ•°å­—å’Œæ¨¡å¼è¯†åˆ«
                const hotNumbers = numberFrequency.hot.filter(num => num && !isNaN(parseInt(num)));
                const coldNumbers = numberFrequency.cold.filter(num => num && !isNaN(parseInt(num)));

                // æœ€å5æœŸçš„æ•°å­—(å¦‚æœæœ‰)
                const recentHistory = this.getHistory().slice(-5);
                const recentNumbers = recentHistory
                    .flatMap(record => Object.values(record.numbers).flat())
                    .filter(num => num && !isNaN(parseInt(num)));

                // è¯†åˆ«æ¨¡å¼(å¦‚æ•°å­—å¾ªç¯ã€ç›¸é‚»æ•°å­—ç­‰)
                const patterns = this.identifyPatterns(recentNumbers);

                while (numbers.size < count) {
                    const r = Math.random();
                    let num;

                    // LIVE BETä¸“ç”¨å¢å¼ºç­–ç•¥
                    if (r < 0.40 && hotNumbers.length > 0) {
                        // 40%æ¦‚ç‡é€‰æ‹©çƒ­é—¨æ•°å­—
                        const index = Math.floor(Math.random() * hotNumbers.length);
                        num = hotNumbers[index];
                    } else if (r < 0.50 && patterns.length > 0) {
                        // 10%æ¦‚ç‡ä½¿ç”¨æ£€æµ‹åˆ°çš„æ¨¡å¼
                        const patternIndex = Math.floor(Math.random() * patterns.length);
                        num = patterns[patternIndex];
                    } else if (r < 0.65 && recentNumbers.length > 0) {
                        // 15%æ¦‚ç‡ä½¿ç”¨æœ€è¿‘å‡ºç°çš„æ•°å­—çš„å˜ä½“
                        const baseNumber = recentNumbers[Math.floor(Math.random() * recentNumbers.length)];
                        const baseInt = parseInt(baseNumber);

                        if (!isNaN(baseInt)) {
                            // åˆ›å»ºå˜ä½“(Â±1, Â±10æˆ–æ•°å­—åè½¬)
                            const variant = Math.random() < 0.33 ?
                                (baseInt + (Math.random() < 0.5 ? 1 : -1) + 100) % 100 :
                                Math.random() < 0.66 ?
                                    (baseInt + (Math.random() < 0.5 ? 10 : -10) + 100) % 100 :
                                    parseInt(baseNumber.split('').reverse().join(''));

                            num = variant.toString().padStart(2, '0');
                        } else {
                            num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                        }
                    } else if (r < 0.75 && coldNumbers.length > 0) {
                        // 10%æ¦‚ç‡é€‰æ‹©å†·é—¨æ•°å­—(åå¼¹ç†è®º)
                        const index = Math.floor(Math.random() * coldNumbers.length);
                        num = coldNumbers[index];
                    } else if (r < 0.85 && Object.keys(markovMatrix).length > 0) {
                        // 10%æ¦‚ç‡ä½¿ç”¨é©¬å°”å¯å¤«é“¾é¢„æµ‹
                        const baseStates = Object.keys(markovMatrix);
                        if (baseStates.length > 0) {
                            const baseState = baseStates[Math.floor(Math.random() * baseStates.length)];

                            const transitions = markovMatrix[baseState];
                            if (transitions) {
                                const nextStates = Object.keys(transitions);
                                const weights = nextStates.map(state => transitions[state]);

                                if (weights.length > 0 && weights.some(w => w > 0)) {
                                    const selectedIndex = this.getWeightedRandomIndex(weights);
                                    num = nextStates[selectedIndex];
                                } else {
                                    num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                                }
                            } else {
                                num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                            }
                        } else {
                            num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                        }
                    } else {
                        // 15%å®Œå…¨éšæœº
                        num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    }

                    // ç¡®ä¿æ˜¯æœ‰æ•ˆçš„ä¸¤ä½æ•°å­—
                    if (!num || num === "undefined" || num === "NaN" || isNaN(parseInt(num))) {
                        num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    } else {
                        // ç¡®ä¿æ˜¯ä¸¤ä½æ•°æ ¼å¼
                        num = parseInt(num).toString().padStart(2, '0');
                    }

                    // æ ¹æ®ä½ç½®(å‰äºŒæˆ–åäºŒ)è¿›ä¸€æ­¥ä¼˜åŒ–
                    if (position === 'tien' && this.getHistory().length > 0) {
                        // å‰äºŒä¼˜åŒ–:æ›´å¤šå…³æ³¨æœ€å‰é¢çš„æ•°å­—
                        const frontDigitPatterns = this.getHistory()
                            .slice(-10)
                            .map(record => Object.values(record.numbers).flat())
                            .flat()
                            .filter(num => num && num.length >= 2 && !isNaN(parseInt(num)))
                            .map(num => num[0])
                            .filter((v, i, a) => a.indexOf(v) === i); // å»é‡

                        if (frontDigitPatterns.length > 0 && Math.random() < 0.3) {
                            // 30%æ¦‚ç‡ä½¿ç”¨å†å²å‰ä½æ•°å­—æ¨¡å¼
                            const frontDigit = frontDigitPatterns[Math.floor(Math.random() * frontDigitPatterns.length)];
                            const backDigit = num.length >= 2 ? num[1] : Math.floor(Math.random() * 10).toString();
                            num = frontDigit + backDigit;

                            // æ£€æŸ¥æ˜¯å¦æœ‰ä¸æ˜¯æ•°å­—çš„å­—ç¬¦
                            if (!/^\d{2}$/.test(num)) {
                                num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                            }
                        }
                    } else if (position === 'hau' && this.getHistory().length > 0) {
                        // åäºŒä¼˜åŒ–:æ›´å¤šå…³æ³¨æœ€åé¢çš„æ•°å­—
                        const backDigitPatterns = this.getHistory()
                            .slice(-10)
                            .map(record => Object.values(record.numbers).flat())
                            .flat()
                            .filter(num => num && num.length >= 2 && !isNaN(parseInt(num)))
                            .map(num => num[1])
                            .filter((v, i, a) => a.indexOf(v) === i); // å»é‡

                        if (backDigitPatterns.length > 0 && Math.random() < 0.3) {
                            // 30%æ¦‚ç‡ä½¿ç”¨å†å²åä½æ•°å­—æ¨¡å¼
                            const frontDigit = num.length >= 1 ? num[0] : Math.floor(Math.random() * 10).toString();
                            const backDigit = backDigitPatterns[Math.floor(Math.random() * backDigitPatterns.length)];
                            num = frontDigit + backDigit;

                            // æ£€æŸ¥æ˜¯å¦æœ‰ä¸æ˜¯æ•°å­—çš„å­—ç¬¦
                            if (!/^\d{2}$/.test(num)) {
                                num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                            }
                        }
                    }

                    // æœ€åç¡®è®¤æ ¼å¼æ­£ç¡®
                    if (typeof num !== 'string' || num.length !== 2 || isNaN(parseInt(num)) || !/^\d{2}$/.test(num)) {
                        num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                    }

                    numbers.add(num);
                }

                return Array.from(numbers).sort((a, b) => parseInt(a) - parseInt(b));
            }

            // è¯†åˆ«æ•°å­—æ¨¡å¼
            identifyPatterns(numbers) {
                const patterns = [];

                // ä¸è¶³ä»¥åˆ†ææˆ–åŒ…å«æ— æ•ˆå€¼
                if (numbers.length < 5) return patterns;

                // è¿‡æ»¤æœ‰æ•ˆæ•°å­—
                const validNumbers = numbers.filter(num => num && !isNaN(parseInt(num)));
                if (validNumbers.length < 5) return patterns;

                // æ£€æµ‹è¿ç»­æ•°å­—æ¨¡å¼
                for (let i = 0; i < validNumbers.length - 1; i++) {
                    const current = parseInt(validNumbers[i]);
                    const next = parseInt(validNumbers[i + 1]);

                    if (isNaN(current) || isNaN(next)) continue;

                    // æ£€æµ‹+1æ¨¡å¼
                    if (next === (current + 1) % 100) {
                        patterns.push(((next + 1) % 100).toString().padStart(2, '0'));
                    }

                    // æ£€æµ‹-1æ¨¡å¼
                    if (next === (current - 1 + 100) % 100) {
                        patterns.push(((next - 1 + 100) % 100).toString().padStart(2, '0'));
                    }

                    // æ£€æµ‹+10æ¨¡å¼
                    if (next === (current + 10) % 100) {
                        patterns.push(((next + 10) % 100).toString().padStart(2, '0'));
                    }

                    // æ£€æµ‹åè½¬æ¨¡å¼
                    const reversed = parseInt(current.toString().padStart(2, '0').split('').reverse().join(''));
                    if (!isNaN(reversed) && next === reversed) {
                        const nextReversed = parseInt(next.toString().padStart(2, '0').split('').reverse().join(''));
                        if (!isNaN(nextReversed)) {
                            patterns.push(nextReversed.toString().padStart(2, '0'));
                        }
                    }
                }

                // è¿”å›ä¸é‡å¤çš„æ¨¡å¼ä¸”ç¡®ä¿éƒ½æ˜¯æœ‰æ•ˆæ•°å­—
                return [...new Set(patterns)].filter(num => /^\d{2}$/.test(num));
            }

            // åŸºäºæƒé‡æ•°ç»„è·å–éšæœºç´¢å¼•
            getWeightedRandomIndex(weights) {
                const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
                let random = Math.random() * totalWeight;

                for (let i = 0; i < weights.length; i++) {
                    random -= weights[i];
                    if (random <= 0) {
                        return i;
                    }
                }

                // é»˜è®¤è¿”å›æœ€åä¸€ä¸ªç´¢å¼•
                return weights.length - 1;
            }
        }

        // åˆå§‹åŒ–é«˜çº§å½©ç¥¨ç®¡ç†å™¨
        const lotteryManager = new AdvancedLotteryManager();

        // æ·»åŠ æ˜æš—ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        document.getElementById('themeToggle').addEventListener('click', () => {
            const body = document.body;
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                document.getElementById('themeToggle').innerHTML = '<span>ğŸŒ™</span>';
            } else {
                body.setAttribute('data-theme', 'dark');
                document.getElementById('themeToggle').innerHTML = '<span>â˜€ï¸</span>';
            }
        });

        // æ›´æ–°çœä»½ä¸‹æ‹‰åˆ—è¡¨
        function updateProvinceDropdown(region) {
            const provinceSelect = document.getElementById('province');
            provinceSelect.innerHTML = '';

            provinces[region].forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                provinceSelect.appendChild(option);
            });
        }

        // ç”Ÿæˆæ¯å‘¨æŠ•æ³¨å»ºè®®
        function generateWeeklyTips() {
            const weeklyTipsContainer = document.getElementById('weeklyTips');
            weeklyTipsContainer.innerHTML = '';

            const days = [
                { name: 'Thá»© Hai', key: 'monday' },
                { name: 'Thá»© Ba', key: 'tuesday' },
                { name: 'Thá»© TÆ°', key: 'wednesday' },
                { name: 'Thá»© NÄƒm', key: 'thursday' },
                { name: 'Thá»© SÃ¡u', key: 'friday' },
                { name: 'Thá»© Báº£y', key: 'saturday' },
                { name: 'Chá»§ Nháº­t', key: 'sunday' }
            ];

            // è·å–å½“å‰æ˜¯æ˜ŸæœŸå‡ 
            const today = new Date().getDay(); // 0 æ˜¯å‘¨æ—¥, 1-6 æ˜¯å‘¨ä¸€åˆ°å‘¨å…­
            const todayIndex = today === 0 ? 6 : today - 1; // è°ƒæ•´ä¸ºæˆ‘ä»¬çš„æ•°ç»„ç´¢å¼•

            days.forEach((day, index) => {
                const dayTips = weeklyTips[day.key];
                const isToday = index === todayIndex;

                // æ‰¾å‡ºå½“å¤©æœ€é«˜èƒœç‡
                let highestRate = 0;
                dayTips.forEach(tip => {
                    const rate = parseInt(tip.rate);
                    if (rate > highestRate) highestRate = rate;
                });

                // æ£€æŸ¥æ˜¯å¦ä¸ºæœ€ä½³æ—¥
                const isOptimalDay = highestRate >= 80;

                const dayCard = document.createElement('div');
                dayCard.className = `day-card ${isToday ? 'optimal-day' : ''}`;

                dayCard.innerHTML = `
                    <div class="day-name">${day.name}${isToday ? ' (HÃ´m nay)' : ''}</div>
                    ${dayTips.map(tip => `
                        <div class="region-tip">
                            <span class="region-name">${tip.region} (${tip.provinces.join(', ')})</span>
                            <span class="win-rate ${parseInt(tip.rate) >= 75 ? 'high-rate' : (parseInt(tip.rate) >= 65 ? 'medium-rate' : 'low-rate')}">${tip.rate}</span>
                        </div>
                    `).join('')}
                `;

                weeklyTipsContainer.appendChild(dayCard);
            });
        }

        // æ›´æ–°æ˜¾ç¤ºç»“æœå‡½æ•°
        function displayResults(region, province) {
            const resultDiv = document.getElementById('result');

            try {
                // ç”Ÿæˆä¸åŒç±»å‹çš„å·ç é›†
                const ghep4D = lotteryManager.generateNumbers('ghep4D', 7);
                const ghep3D = lotteryManager.generateNumbers('ghep3D', 7);
                const dan2D = lotteryManager.generateNumbers('normal', 64);

                // å¯¹äºéLIVE BETåŒºåŸŸï¼Œæ‰ç”Ÿæˆè¿™äº›æ•°æ®
                let xienPairs, mega645, power655;
                if (region !== "live-bet") {
                    xienPairs = lotteryManager.generateNumbers('xien-pairs');
                    mega645 = lotteryManager.generateNumbers('mega645', 6);
                    power655 = lotteryManager.generateNumbers('power655', 6);
                }

                const numbers = {
                    ghep4D,
                    ghep3D,
                    dan2D
                };

                // åªæœ‰éLIVE BETåŒºåŸŸæ‰æ·»åŠ è¿™äº›æ•°æ®
                if (region !== "live-bet") {
                    numbers.xienPairs = xienPairs;
                    numbers.mega645 = mega645;
                    numbers.power655 = power655;
                }

                // ä¸ºLIVE BETæ·»åŠ "Tiá»n Nhá»‹"å’Œ"Háº­u Nhá»‹"
                if (region === "live-bet") {
                    const tienNhi = lotteryManager.generateNumbers('tien-nhi', 32);
                    const hauNhi = lotteryManager.generateNumbers('hau-nhi', 32);

                    // ç¡®ä¿æ•°å­—æœ‰æ•ˆ
                    numbers.tienNhi = tienNhi
                        .filter(num => num && !isNaN(parseInt(num)) && /^\d{2}$/.test(num))
                        .map(num => parseInt(num).toString().padStart(2, '0'));

                    numbers.hauNhi = hauNhi
                        .filter(num => num && !isNaN(parseInt(num)) && /^\d{2}$/.test(num))
                        .map(num => parseInt(num).toString().padStart(2, '0'));

                    // å¦‚æœè¿‡æ»¤åæ•°é‡ä¸è¶³ï¼Œè¡¥å……æ•°å­—
                    while (numbers.tienNhi.length < 32) {
                        const num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                        if (!numbers.tienNhi.includes(num)) {
                            numbers.tienNhi.push(num);
                        }
                    }

                    while (numbers.hauNhi.length < 32) {
                        const num = Math.floor(Math.random() * 100).toString().padStart(2, '0');
                        if (!numbers.hauNhi.includes(num)) {
                            numbers.hauNhi.push(num);
                        }
                    }

                    // æ’åº
                    numbers.tienNhi.sort((a, b) => parseInt(a) - parseInt(b));
                    numbers.hauNhi.sort((a, b) => parseInt(a) - parseInt(b));
                }

                // ä¿å­˜ç»“æœ
                lotteryManager.saveResult(region, province, numbers);

                // æ˜¾ç¤ºç»“æœ
                let resultHTML = `
                    <div class="card result-section">
                        <h2 style="color: var(--primary-color); margin-bottom: 20px; text-align: center;">Káº¿t quáº£ Xá»• Sá»‘: ${province}</h2>
                        
                        <div class="number-set">
                            <h3>GhÃ©p 4D:</h3>
                            <p class="number-result">${ghep4D.join(', ')}</p>
                            <button class="copy-btn" onclick="copyText('${ghep4D.join(', ')}')">Copy</button>
                        </div>

                        <div class="number-set">
                            <h3>GhÃ©p 3D:</h3>
                            <p class="number-result">${ghep3D.join(', ')}</p>
                            <button class="copy-btn" onclick="copyText('${ghep3D.join(', ')}')">Copy</button>
                        </div>`;

                // ä¸ºLIVE BETæ·»åŠ "Tiá»n Nhá»‹"å’Œ"Háº­u Nhá»‹"æ˜¾ç¤º
                if (region === "live-bet" && numbers.tienNhi && numbers.tienNhi.length > 0) {
                    resultHTML += `
                        <div class="number-set">
                            <h3>Tiá»n Nhá»‹:</h3>
                            <div class="number-grid">
                                ${numbers.tienNhi.map(num => `
                                    <div class="number-cell ${Math.random() > 0.8 ? 'hot-number' : Math.random() > 0.7 ? 'cold-number' : ''}">${num}</div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${numbers.tienNhi.join(', ')}')">Copy</button>
                        </div>`;
                }

                if (region === "live-bet" && numbers.hauNhi && numbers.hauNhi.length > 0) {
                    resultHTML += `
                        <div class="number-set">
                            <h3>Háº­u Nhá»‹:</h3>
                            <div class="number-grid">
                                ${numbers.hauNhi.map(num => `
                                    <div class="number-cell ${Math.random() > 0.8 ? 'hot-number' : Math.random() > 0.7 ? 'cold-number' : ''}">${num}</div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${numbers.hauNhi.join(', ')}')">Copy</button>
                        </div>`;
                }

                resultHTML += `
                        <div class="number-set">
                            <h3>DÃ n 2D - 64 Sá»‘:</h3>
                            <div class="number-grid">
                                ${dan2D.map(num => `
                                    <div class="number-cell ${Math.random() > 0.8 ? 'hot-number' : Math.random() > 0.7 ? 'cold-number' : ''}">${num}</div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${dan2D.join(', ')}')">Copy</button>
                        </div>`;

                // åªæœ‰éLIVE BETåŒºåŸŸæ‰æ˜¾ç¤ºè¿™äº›éƒ¨åˆ†
                if (region !== "live-bet" && xienPairs && xienPairs.length > 0) {
                    resultHTML += `
                        <div class="number-set">
                            <h3>DÃ n LÃ´ XiÃªn (Cáº·p sá»‘ xÃ¡c suáº¥t cao):</h3>
                            <div class="xien-container">
                                ${xienPairs.map(pair => `
                                    <div class="xien-pair">
                                        <div class="xien-numbers">${pair.pair ? pair.pair.replace('-', ' - ') : ''}</div>
                                        <div class="xien-probability">${pair.probability ? pair.probability + '%' : '0%'}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${xienPairs.map(p => p.pair || '').filter(p => p).join(', ')}')">Copy</button>
                        </div>`;
                }

                if (region !== "live-bet" && mega645 && mega645.length > 0) {
                    resultHTML += `
                        <div class="number-set">
                            <h3>Mega 6/45:</h3>
                            <div class="number-grid">
                                ${mega645.map(num => `
                                    <div class="number-cell ${Math.random() > 0.8 ? 'pattern-number' : ''}">${num}</div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${mega645.join(', ')}')">Copy</button>
                        </div>`;
                }

                if (region !== "live-bet" && power655 && power655.length > 0) {
                    resultHTML += `
                        <div class="number-set">
                            <h3>Power 6/55:</h3>
                            <div class="number-grid">
                                ${power655.map(num => `
                                    <div class="number-cell ${Math.random() > 0.8 ? 'pattern-number' : ''}">${num}</div>
                                `).join('')}
                            </div>
                            <button class="copy-btn" onclick="copyText('${power655.join(', ')}')">Copy</button>
                        </div>`;
                }

                resultHTML += `
                    </div>
                `;

                resultDiv.innerHTML = resultHTML;
            } catch (error) {
                console.error("Error in displayResults:", error);
                resultDiv.innerHTML = `
                    <div class="card result-section">
                        <h2 style="color: #e63946; margin-bottom: 20px; text-align: center;">CÃ³ lá»—i xáº£y ra</h2>
                        <p style="text-align: center;">Vui lÃ²ng thá»­ láº¡i hoáº·c chá»n Ä‘Ã i khÃ¡c.</p>
                    </div>
                `;
            }
        }

        // å¤åˆ¶æ–‡æœ¬å¤„ç†
        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ÄÃ£ sao chÃ©p!');
            }).catch(err => {
                showNotification('KhÃ´ng thá»ƒ sao chÃ©p: ' + err);
            });
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('region').addEventListener('change', (e) => {
            updateProvinceDropdown(e.target.value);
            document.getElementById('blockedMessage').style.display = 'none';
        });

        document.getElementById('startSimulation').addEventListener('click', () => {
            const region = document.getElementById('region').value;
            const province = document.getElementById('province').value;

            // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»ä¸ºè¯¥çœä»½ç”Ÿæˆè¿‡
            if (lotteryManager.canGenerateToday(province)) {
                document.getElementById('blockedMessage').style.display = 'none';
                document.querySelector('.loading').style.display = 'block';
                document.getElementById('result').innerHTML = '';

                // ç¼©çŸ­LIVE BETçš„ç­‰å¾…æ—¶é—´ï¼Œå…¶ä»–ä¿æŒä¸å˜
                const waitTime = region === 'live-bet' ? 500 : 2000;

                setTimeout(() => {
                    try {
                        displayResults(region, province);
                    } catch (error) {
                        console.error("Error generating results:", error);
                        document.getElementById('result').innerHTML = `
                            <div class="card result-section">
                                <h2 style="color: #e63946; margin-bottom: 20px; text-align: center;">CÃ³ lá»—i xáº£y ra</h2>
                                <p style="text-align: center;">Vui lÃ²ng thá»­ láº¡i hoáº·c chá»n Ä‘Ã i khÃ¡c.</p>
                            </div>
                        `;
                    }
                    document.querySelector('.loading').style.display = 'none';
                }, waitTime);
            } else {
                // å¦‚æœä»Šå¤©å·²ç»ç”Ÿæˆè¿‡ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                document.getElementById('blockedMessage').style.display = 'block';
            }
        });

        document.getElementById('refreshButton').addEventListener('click', () => {
            location.reload();
        });

        document.getElementById('resetSpin').addEventListener('click', () => {
            lotteryManager.clearHistory();
            showNotification('ÄÃ£ reset toÃ n bá»™ dá»¯ liá»‡u!');
            document.getElementById('blockedMessage').style.display = 'none';
        });

        // åˆå§‹åŒ–
        updateProvinceDropdown(document.getElementById('region').value);
        generateWeeklyTips();

        // æ£€æŸ¥æ˜¯å¦æ˜¯æ·±è‰²æ¨¡å¼åå¥½
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.setAttribute('data-theme', 'dark');
            document.getElementById('themeToggle').innerHTML = '<span>â˜€ï¸</span>';
        }
    </script>
</body>

</html>
