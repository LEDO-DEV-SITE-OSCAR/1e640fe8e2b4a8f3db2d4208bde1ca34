<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Xổ Số - Phiên Bản Nâng Cao</title>
    <link rel="icon" href="lottery.png" type="image/png">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            width: 90%;
            max-width: 1000px;
            margin: 20px auto;
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .input-section {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #fff;
            font-size: 1.1em;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        .btn {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .stats-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #fff;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .number-cell {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .number-cell:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hot-number {
            background: rgba(255, 87, 87, 0.3);
        }

        .cold-number {
            background: rgba(87, 87, 255, 0.3);
        }

        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            background: #4CAF50;
            color: white;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Xổ Số Miền Bắc Trung Nam</h1>
        <div class="input-section">
            <div class="input-group">
                <label for="region">Chọn miền:</label>
                <select id="region">
                    <option value="Miền Bắc">Xổ Số Miền Bắc</option>
                    <option value="Miền Trung">Xổ Số Miền Trung</option>
                    <option value="Miền Nam">Xổ Số Miền Nam</option>
                    <option value="Lotto Ku">Lotto Ku</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="province">Chọn đài xổ số:</label>
                <select id="province"></select>
            </div>

            <button class="btn" id="startSimulation">Phân Tích & Dự Đoán</button>
            <button class="btn" id="refreshButton">Làm Mới</button>
            <button class="btn" id="resetSpin">Reset Dữ Liệu</button>
        </div>

        <div id="statistics" class="stats-container" style="display: none;">
            <div class="stats-title">Thống Kê & Phân Tích</div>
            <div id="hotNumbers" class="stat-item">
                <span>Số hay về (Hot):</span>
                <span id="hotNumbersList"></span>
            </div>
            <div id="coldNumbers" class="stat-item">
                <span>Số lâu chưa về (Cold):</span>
                <span id="coldNumbersList"></span>
            </div>
            <div id="patterns" class="stat-item">
                <span>Mẫu số thường xuất hiện:</span>
                <span id="patternsList"></span>
            </div>
        </div>

        <div id="output" class="result-section" style="display: none;">
            <div id="loading">Đang phân tích dữ liệu...</div>
            <div id="result"></div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // Lớp quản lý dữ liệu lịch sử
        class HistoryManager {
            constructor() {
                this.storage = localStorage;
                this.KEY_PREFIX = 'lottery_history_';
            }

            saveResult(gameType, numbers) {
                const key = this.KEY_PREFIX + gameType;
                let history = this.getHistory(gameType);
                history.push({
                    numbers: numbers,
                    timestamp: new Date().getTime()
                });
                // Giới hạn lịch sử 100 kết quả gần nhất
                if (history.length > 100) history.shift();
                this.storage.setItem(key, JSON.stringify(history));
            }

            getHistory(gameType) {
                const key = this.KEY_PREFIX + gameType;
                const history = this.storage.getItem(key);
                return history ? JSON.parse(history) : [];
            }

            clearHistory(gameType) {
                if (gameType) {
                    this.storage.removeItem(this.KEY_PREFIX + gameType);
                } else {
                    Object.keys(this.storage).forEach(key => {
                        if (key.startsWith(this.KEY_PREFIX)) {
                            this.storage.removeItem(key);
                        }
                    });
                }
            }
        }

        // Lớp phân tích số liệu
        class NumberAnalyzer {
            constructor(historyManager) {
                this.historyManager = historyManager;
            }

            getHotNumbers(gameType, limit = 5) {
                const history = this.historyManager.getHistory(gameType);
                const frequency = {};
                
                history.forEach(record => {
                    record.numbers.forEach(num => {
                        frequency[num] = (frequency[num] || 0) + 1;
                    });
                });

                return Object.entries(frequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, limit)
                    .map(entry => entry[0]);
            }

            getColdNumbers(gameType, limit = 5) {
                const history = this.historyManager.getHistory(gameType);
                const allPossibleNumbers = this.getAllPossibleNumbers(gameType);
                const frequency = {};
                
                allPossibleNumbers.forEach(num => {
                    frequency[num] = 0;
                });

                history.forEach(record => {
                    record.numbers.forEach(num => {
                        frequency[num] = (frequency[num] || 0) + 1;
                    });
                });

                return Object.entries(frequency)
                    .sort((a, b) => a[1] - b[1])
                    .slice(0, limit)
                    .map(entry => entry[0]);
            }

            findPatterns(gameType) {
                const history = this.historyManager.getHistory(gameType);
                const patterns = [];
                
                // Phân tích chuỗi số
                for (let i = 1; i < history.length; i++) {
                    const current = history[i].numbers;
                    const previous = history[i-1].numbers;
                    
                    // Tìm các số lặp lại
                    const repeatedNumbers = current.filter(num => previous.includes(num));
                    if (repeatedNumbers.length > 0) {
                        patterns.push({
                            type: 'repeat',
                            numbers: repeatedNumbers
                        });
                    }

                    // Tìm các chuỗi số liên tiếp
                    const sortedCurrent = [...current].sort((a, b) => a - b);
                    for (let j = 0; j < sortedCurrent.length - 1; j++) {
                        if (parseInt(sortedCurrent[j+1]) - parseInt(sortedCurrent[j]) === 1) {
                            patterns.push({
                                type: 'sequence',
                                numbers: [sortedCurrent[j], sortedCurrent[j+1]]
                            });
                        }
                    }
                }

                return this.summarizePatterns(patterns);
            }

            summarizePatterns(patterns) {
                const summary = {
                    repeat: new Set(),
                    sequence: new Set()
                };

                patterns.forEach(pattern => {
                    if (pattern.type === 'repeat') {
                        pattern.numbers.forEach(num => summary.repeat.add(num));
                    } else if (pattern.type === 'sequence') {
                        pattern.numbers.forEach(num => summary.sequence.add(num));
                    }
                });

                return {
                    repeatedNumbers: Array.from(summary.repeat),
                    sequences: Array.from(summary.sequence)
                };
            }

            getAllPossibleNumbers(gameType) {
                switch(gameType) {
                    case 'Miền Bắc':
                        return Array.from({length: 100}, (_, i) => i.toString().padStart(2, '0'));
                    case 'Mega 6/45':
                        return Array.from({length: 45}, (_, i) => (i + 1).toString().padStart(2, '0'));
                    case 'Power 6/55':
                        return Array.from({length: 55}, (_, i) => (i + 1).toString().padStart(2, '0'));
                    default:
                        return Array.from({length: 100}, (_, i) => i.toString().padStart(2, '0'));
                }
            }
        }

        // Lớp sinh số
        class NumberGenerator {
            constructor(analyzer) {
                this.analyzer = analyzer;
            }

            generateNumbers(gameType, count) {
                const hotNumbers = this.analyzer.getHotNumbers(gameType);
                const coldNumbers = this.analyzer.getColdNumbers(gameType);
                const patterns = this.analyzer.findPatterns(gameType);
                
                const numbers = new Set();
                const maxAttempts = 1000;
                let attempts = 0;

                while (numbers.size < count && attempts < maxAttempts) {
                    attempts++;

                    // 40% cơ hội chọn số nóng
                    if (Math.random() < 0.4 && hotNumbers.length > 0) {
                        numbers.add(hotNumbers[Math.floor(Math.random() * hotNumbers.length)]);
                        continue;
                    }

                    // 20% cơ hội chọn số lạnh
                    if (Math.random() < 0.2 && coldNumbers.length > 0) {
                        numbers.add(coldNumbers[Math.floor(Math.random() * coldNumbers.length)]);
                        continue;
                    }

                    // 20% cơ hội chọn số từ mẫu
                    if (Math.random() < 0.2 && patterns.repeatedNumbers.length > 0) {
                        numbers.add(patterns.repeatedNumbers[Math.floor(Math.random() * patterns.repeatedNumbers.length)]);
                        continue;
                    }

                    // 20% còn lại là số ngẫu nhiên
                    const randomNum = Math.floor(Math.random() * this.getMaxNumber(gameType)).toString().padStart(2, '0');
                    numbers.add(randomNum);
                }

                return Array.from(numbers).slice(0, count);
            }

            getMaxNumber(gameType) {
                switch(gameType) {
                    case 'Mega 6/45': return 45;
                    case 'Power 6/55': return 55;
                    default: return 100;
                }
            }
        }

        // Khởi tạo các đối tượng
        const historyManager = new HistoryManager();
        const numberAnalyzer = new NumberAnalyzer(historyManager);
        const numberGenerator = new NumberGenerator(numberAnalyzer);

        // Định nghĩa các tỉnh/thành cho từng miền
        const provinces = {
            "Miền Bắc": ["Hà Nội"],
            "Miền Trung": [
                "Kon Tum", "Khánh Hòa", "Phú Yên", "Thừa Thiên Huế", "Đắk Lắk",
                "Quảng Nam", "Bình Định", "Quảng Bình", "Quảng Trị", "Gia Lai",
                "Ninh Thuận", "Đà Nẵng", "Đắk Nông", "Quảng Ngãi"
            ],
            "Miền Nam": [
                "TP.HCM", "Kiên Giang", "Lâm Đồng", "Tiền Giang", "Cà Mau",
                "Đồng Tháp", "Bạc Liêu", "Bến Tre", "Vũng Tàu", "Cần Thơ",
                "Sóc Trăng", "An Giang", "Tây Ninh", "Bình Dương", "Bình Phước",
                "Hậu Giang", "Long An", "Đồng Nai", "Trà Vinh"
            ],
            "Lotto Ku": ["Lotto Win"]
        };

        // Cập nhật dropdown tỉnh/thành
        function updateProvinceDropdown(region) {
            const provinceDropdown = document.getElementById("province");
            provinceDropdown.innerHTML = "";
            provinces[region].forEach(province => {
                const option = document.createElement("option");
                option.value = province;
                option.textContent = province;
                provinceDropdown.appendChild(option);
            });
        }

        // Hiển thị kết quả
        function displayResults(gameType, numbers) {
            const resultDiv = document.getElementById('result');
            const statistics = document.getElementById('statistics');
            
            // Hiển thị thống kê
            statistics.style.display = 'block';
            document.getElementById('hotNumbersList').textContent = numberAnalyzer.getHotNumbers(gameType).join(', ');
            document.getElementById('coldNumbersList').textContent = numberAnalyzer.getColdNumbers(gameType).join(', ');
            
            const patterns = numberAnalyzer.findPatterns(gameType);
            document.getElementById('patternsList').textContent = 
                `Lặp lại: ${patterns.repeatedNumbers.join(', ')} | Dãy số: ${patterns.sequences.join(', ')}`;

            // Hiển thị kết quả dự đoán
            resultDiv.innerHTML = `
                <h3>Kết Quả Dự Đoán:</h3>
                <div class="number-grid">
                    ${numbers.map(num => `
                        <div class="number-cell ${numberAnalyzer.getHotNumbers(gameType).includes(num) ? 'hot-number' : 
                            numberAnalyzer.getColdNumbers(gameType).includes(num) ? 'cold-number' : ''}">
                            ${num}
                        </div>
                    `).join('')}
                </div>
            `;

            // Lưu kết quả vào lịch sử
            historyManager.saveResult(gameType, numbers);
        }

        // Xử lý sự kiện
        document.getElementById("region").addEventListener("change", (e) => {
            updateProvinceDropdown(e.target.value);
        });

        document.getElementById("startSimulation").addEventListener("click", () => {
            const region = document.getElementById("region").value;
            const province = document.getElementById("province").value;
            
            document.getElementById("loading").style.display = "block";
            document.getElementById("output").style.display = "block";

            setTimeout(() => {
                let numbers;
                switch(region) {
                    case "Miền Bắc":
                        numbers = numberGenerator.generateNumbers(region, 7);
                        break;
                    case "Lotto Ku":
                        numbers = numberGenerator.generateNumbers(region, 7);
                        break;
                    default:
                        numbers = numberGenerator.generateNumbers(region, 6);
                }

                displayResults(region, numbers);
                document.getElementById("loading").style.display = "none";
            }, 1500);
        });

        document.getElementById("refreshButton").addEventListener("click", () => {
            location.reload();
        });

        document.getElementById("resetSpin").addEventListener("click", () => {
            historyManager.clearHistory();
            showNotification("Đã reset toàn bộ dữ liệu!");
        });

        function showNotification(message) {
            const notification = document.getElementById("notification");
            notification.textContent = message;
            notification.style.display = "block";
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }

        // Khởi tạo ban đầu
        updateProvinceDropdown(document.getElementById("region").value);
    </script>
</body>
</html>
