<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xử lý Dữ liệu XSMB</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #000;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .section-title {
            font-size: 1.5em;
            margin-top: 20px;
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <h1>Phân bổ Dữ liệu XSMB - Ngày Gần Nhất</h1>

    <div class="section-title">Giải thưởng:</div>
    <table id="prizes-table">
        <tr>
            <th>Giải</th>
            <th>Giá trị</th>
        </tr>
    </table>

    <div class="section-title">Đầu - Đuôi Lô Tô:</div>
    <table id="head-tail-table">
        <tr>
            <th>Đầu</th>
            <th>Đuôi</th>
        </tr>
    </table>

    <script>
        async function fetchData() {
            const url = 'https://raw.githubusercontent.com/LEDO-DEV-SITE-OSCAR/API_XSMB/refs/heads/main/data/xsmb.csv';
            const response = await fetch(url);
            const data = await response.text();
            parseData(data);
        }

        function parseData(data) {
            const rows = data.split('\n').map(row => row.split(','));

            // Tìm ngày gần nhất
            const dateStrings = rows.map(row => row[0]);
            const dates = dateStrings.map(dateStr => new Date(dateStr.split('-').reverse().join('-')));

            // Tìm ngày gần nhất
            const closestDateIndex = dates.reduce((closestIndex, date, index) => {
                const currentDate = new Date();
                const closestDate = new Date(dates[closestIndex]);
                return (Math.abs(date - currentDate) < Math.abs(closestDate - currentDate)) ? index : closestIndex;
            }, 0);

            const closestDateData = rows[closestDateIndex];

            if (closestDateData) {
                // Giải thưởng
                const prizes = {
                    'Đặc biệt': closestDateData[1],
                    'Giải nhất': closestDateData[2],
                    'Giải nhì': closestDateData[3],
                    'Giải ba': closestDateData[4],
                    'Giải tư': closestDateData[5],
                    'Giải năm': closestDateData[6],
                    'Giải sáu': closestDateData[7],
                    'Giải bảy': closestDateData[8]
                };

                // Hiển thị giải thưởng
                const prizeTable = document.getElementById('prizes-table');
                for (const [prize, value] of Object.entries(prizes)) {
                    const row = document.createElement('tr');
                    const cell1 = document.createElement('td');
                    cell1.textContent = prize;
                    const cell2 = document.createElement('td');
                    cell2.textContent = value;
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    prizeTable.appendChild(row);
                }

                // Đầu - Đuôi Lô Tô
                const lottoData = closestDateData.slice(9); // Lấy phần dữ liệu Lô Tô từ cột 10 trở đi
                const headTailData = {};

                // Phân bổ theo đầu và đuôi
                lottoData.forEach(number => {
                    if (number.trim()) {
                        const head = number.charAt(0); // Lấy đầu
                        const tail = number.charAt(number.length - 1); // Lấy đuôi

                        if (!headTailData[head]) headTailData[head] = [];
                        if (!headTailData[tail]) headTailData[tail] = [];

                        headTailData[head].push(tail);
                        headTailData[tail].push(head);
                    }
                });

                // Hiển thị Đầu - Đuôi Lô Tô
                const headTailTable = document.getElementById('head-tail-table');
                Object.entries(headTailData).forEach(([key, value]) => {
                    const row = document.createElement('tr');
                    const cell1 = document.createElement('td');
                    cell1.textContent = key;
                    const cell2 = document.createElement('td');
                    cell2.textContent = value.join(', ');
                    row.appendChild(cell1);
                    row.appendChild(cell2);
                    headTailTable.appendChild(row);
                });
            } else {
                alert('Không có dữ liệu cho ngày gần nhất.');
            }
        }

        // Gọi hàm khi tải trang
        fetchData();
    </script>

</body>
</html>
